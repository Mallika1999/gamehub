<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Guess the Country by Flag</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://unpkg.com/topojson@3"></script>

<style>
    body {
        font-family: Arial, sans-serif;
        background: linear-gradient(135deg, #ff9a9e, #fad0c4);
        display: flex;
        justify-content: center;
        padding: 40px 0;
        margin: 0;
    }

    #container {
        background: white;
        padding: 25px 20px;
        width: 90%;
        max-width: 500px;
        border-radius: 15px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        text-align: center;
    }

    h2 {
        margin-top: 0;
        color: #333;
    }

    #map {
        width: 350px;
        height: 250px;
        margin: 20px auto;
        display: block;
    }

    .option-btn {
        width: 90%;
        padding: 12px;
        margin: 8px 0;
        font-size: 16px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        background: linear-gradient(to right, #6a11cb, #2575fc);
        color: white;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .option-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }

    .correct {
        background: #2ecc71 !important;
        color: white !important;
    }

    .incorrect {
        background: #e74c3c !important;
        color: white !important;
    }

    #final-score {
        font-size: 22px;
        font-weight: bold;
        margin-top: 15px;
        color: #333;
    }

    #restart {
        margin-top: 15px;
        padding: 10px 18px;
        font-size: 16px;
        border: none;
        border-radius: 10px;
        background: #f39c12;
        color: white;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    #restart:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
</style>
</head>

<body>
<div id="container">
    <h2>Guess the Country by Shape üåç</h2>
    <svg id="map"></svg>
    <div id="question-number"></div>
    <div id="options"></div>
    <h3 id="final-score"></h3>
    <button id="restart" style="display:none;" onclick="startQuiz()">Restart Quiz</button>
</div>

<script>
// --- CONFIG ---
const QUESTIONS = 10;
let countries = [];
let quizCountries = [];
let index = 0;
let score = 0;

// --- LOAD WORLD SHAPE DATA ---
d3.json("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json").then(world => {
    const geo = topojson.feature(world, world.objects.countries);
    // Filter out unwanted entries like UN
    countries = geo.features.filter(c => {
        const name = c.properties.name;
        return name && name !== "United Nations";
    });
    startQuiz();
});

// --- START QUIZ ---
function startQuiz() {
    score = 0;
    index = 0;
    quizCountries = d3.shuffle([...countries]).slice(0, QUESTIONS);

    document.getElementById("restart").style.display = "none";
    document.getElementById("final-score").textContent = "";

    loadQuestion();
}

// --- LOAD QUESTION ---
function loadQuestion() {
    const c = quizCountries[index];

    document.getElementById("question-number").textContent =
        `Question ${index + 1} of ${QUESTIONS}`;

    drawCountry(c);
    createOptions(c);
}

// --- DRAW COUNTRY SHAPE ---
function drawCountry(country) {
    const svg = d3.select("#map");
    svg.selectAll("*").remove();

    const projection = d3.geoNaturalEarth1().fitSize([350, 250], country);
    const path = d3.geoPath().projection(projection);

    svg.append("path")
        .attr("d", path(country))
        .attr("fill", "#95a5a6")
        .attr("stroke", "#34495e")
        .attr("stroke-width", 1.5);
}

// --- CREATE OPTIONS ---
function createOptions(correctCountry) {
    const optionsDiv = document.getElementById("options");
    optionsDiv.innerHTML = "";

    let incorrect = d3.shuffle(countries.filter(c => c !== correctCountry))
                     .slice(0, 3);

    let allOptions = d3.shuffle([correctCountry, ...incorrect]);

    allOptions.forEach(opt => {
        let btn = document.createElement("button");
        btn.className = "option-btn";
        btn.textContent = opt.properties.name;

        btn.onclick = () => handleAnswer(btn, opt.properties.name, correctCountry.properties.name);

        optionsDiv.appendChild(btn);
    });
}

// --- HANDLE ANSWER ---
function handleAnswer(button, chosen, correct) {
    const optionsDiv = document.getElementById("options");

    [...optionsDiv.querySelectorAll("button")].forEach(b => b.disabled = true);

    if (chosen === correct) {
        button.classList.add("correct");
        score++;
    } else {
        button.classList.add("incorrect");

        [...optionsDiv.querySelectorAll("button")]
            .find(b => b.textContent === correct)
            .classList.add("correct");
    }

    setTimeout(() => {
        index++;
        if (index >= QUESTIONS) finishQuiz();
        else loadQuestion();
    }, 1200);
}

// --- FINISH QUIZ ---
function finishQuiz() {
    document.getElementById("final-score").textContent =
        `Final Score: ${score} / ${QUESTIONS}`;

    document.getElementById("restart").style.display = "block";

    d3.select("#map").selectAll("*").remove();
    document.getElementById("question-number").textContent = "";
    document.getElementById("options").innerHTML = "";
}
</script>
</body>
</html>
